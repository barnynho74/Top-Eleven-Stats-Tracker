<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="TEicon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Eleven Stats Tracker</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
</head>
<body>
    <!-- Stats Calculator Side Panel -->
    <div class="stats-calculator-panel" id="stats-calculator">
        <div class="calculator-toggle" id="calc-toggle">
            <span class="arrow">◄</span>
        </div>
        <div class="stats-calculator-content">
            <h3>Quick Stats Calculator</h3>
            <table class="stats-calc-table">
                <thead>
                    <tr>
                        <th>Minutes</th>
                        <th>Matches</th>
                        <th>Goals</th>
                        <th>Assists</th>
                    </tr>
                </thead>
                <tbody id="calc-table-body">
                    <!-- Rows will be generated by JavaScript -->
                </tbody>
                <tfoot>
                    <tr>
                        <td class="stats-calc-sum" id="calc-sum-minutes">0</td>
                        <td class="stats-calc-sum" id="calc-sum-matches">0</td>
                        <td class="stats-calc-sum" id="calc-sum-goals">0</td>
                        <td class="stats-calc-sum" id="calc-sum-assists">0</td>
                    </tr>
                </tfoot>
            </table>
            <button class="calc-reset-btn" id="calc-reset-btn">Clear All</button>
        </div>
    </div>
    <div class="top-bar">
        <div class="tab active" data-tab="progress">PROGRESS</div>
        <div class="tab" data-tab="minutes">MINUTES</div>
        <div class="tab" data-tab="goals-assists">GOALS & ASSISTS</div>
        <div class="tab" data-tab="most-improved">MOST IMPROVED</div>
        <div class="tab" data-tab="power-ranking">POWER RANKING</div>
        <div class="tab-container">
            <div class="tab" data-tab="archived-players">ARCHIVED PLAYERS</div>
            <div class="tab-dropdown">
                <div class="dropdown-item" data-tab="hall-of-fame">HALL OF FAME</div>
                <div class="dropdown-item" data-tab="all-time-leaders">ALL-TIME LEADERS</div>
            </div>
        </div>
    </div>
    <div id="progress-content" class="content active">
        <button class="add-player-btn" id="add-player-btn">+</button>
        <div class="squad-average">
            Average quality: <span id="avg-quality">--</span>%<br>
            Squad size: <span id="squad-count">0</span> players<br>
            Average age: <span id="avg-age">--</span>
        </div>
        <div style="margin-bottom: 15px;">
            <label for="sort-option" style="margin-right: 10px; font-weight: bold;">Sort by:</label>
            <select id="sort-option" style="padding: 5px; border-radius: 4px; border: 1px solid #ddd;">
                <option value="position">Position</option>
                <option value="quality">Current Quality</option>
            </select>
        </div>
        <div class="player-list" id="player-list"></div>
        <div class="bottom-actions"><button class="age-all-btn" id="age-all-btn">+1 Year to All Players</button><button class="end-season-btn" id="end-season-btn">End Season & Archive</button></div>
        <hr style="margin: 20px 0;">
        <div id="archive-section">
            <h2>Season Archives & Data Management</h2>
            <div class="data-io-buttons">
                <button id="download-data-btn">Download All Data</button>
                <button id="upload-data-btn">Upload Data File</button>
                <input type="file" id="upload-file-input" style="display:none;" accept=".json">
            </div>
            <p style="font-size: 12px; color: #666; margin-top: -5px; max-width: 350px;">
                Download a single JSON file containing all current players, archived seasons, and settings. Uploading will overwrite all existing data.
            </p>
            <div id="player-search-section" style="margin-top: 20px; margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 5px;">
                <h4 style="margin-top: 0; margin-bottom: 10px; font-size: 15px;">Search Player History</h4>
                <input type="search" id="player-search-input" placeholder="Enter player name to search archives..." style="width: 100%; padding: 8px; box-sizing: border-box; border-radius: 4px; border: 1px solid #ddd;">
                <div id="player-search-results" style="margin-top: 15px;"></div>
            </div>
            <div id="archive-list">
                <p>No archived seasons yet.</p>
            </div>
        </div>
    </div>
    <div id="minutes-content" class="content">
        <h2>Minutes</h2>
        <div class="minutes-form">
            <h3>Add Minutes for Current Match</h3>
            <div class="minutes-controls">
                <button class="full-match-btn" id="full-match-btn">Full Match (90 min)</button>
                <input type="number" class="minutes-input" id="minutes-input" placeholder="Minutes" min="1" max="90">
                <button class="confirm-minutes-btn" id="confirm-minutes-btn">Confirm</button>
                <button class="reset-minutes-btn" id="undo-minutes-btn">Undo Last Change</button>
            </div>
        </div>
        <table id="minutes-table">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Positions</th>
                    <th>Age</th>
                    <th>Quality</th>
                    <th>Total Minutes</th>
                    <th>Matches</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
   <div id="goals-assists-content" class="content">
        <h2>Goals & Assists</h2>
        <div class="minutes-form">
            <button class="reset-minutes-btn" id="undo-ga-btn">Undo Last Change</button>
        </div>
        <div class="table-container">
        <table id="goals-assists-table">
            <thead>
                <tr>
                    <th rowspan="2">Player</th>
                    <th rowspan="2">Positions</th>
                    <th rowspan="2">Age</th>
                    <th rowspan="2">Current Quality</th>
                    <th colspan="2" class="league-header">League</th>
                    <th colspan="2" class="cl-header">Champ. League</th>
                    <th colspan="2" class="cup-header">Cup</th>
                    <th rowspan="2" class="stats-separator">Total G</th>
                    <th rowspan="2">Total A</th>
                    <th rowspan="2">G+A</th>
                    <th rowspan="2" class="per90-separator">G/90min</th>
                    <th rowspan="2">A/90min</th>
                    <th rowspan="2">G+A/90min</th>
                </tr>
                <tr>
                    <th class="league-header">G</th><th class="league-header">A</th>
                    <th class="cl-header">G</th><th class="cl-header">A</th>
                    <th class="cup-header">G</th><th class="cup-header">A</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        </div>
    </div>
    <div id="most-improved-content" class="content">
        <h2>Most Improved Players</h2>
        <div class="table-container">
            <table id="most-improved-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th data-sort="player">Player <span class="sort-indicator">▼</span></th>
                        <th>Positions</th>
                        <th data-sort="age">Age <span class="sort-indicator">▼</span></th>
                        <th data-sort="initialQuality">Initial Quality <span class="sort-indicator">▼</span></th>
                        <th data-sort="currentQuality">Current Quality <span class="sort-indicator">▼</span></th>
                        <th data-sort="minutes">Minutes <span class="sort-indicator">▼</span></th>
                        <th data-sort="matches">Matches <span class="sort-indicator">▼</span></th>
                        <th data-sort="avgMinPerMatch">Avg Min/90 <span class="sort-indicator">▼</span></th>
                        <th data-sort="g">G <span class="sort-indicator">▼</span></th>
                        <th data-sort="a">A <span class="sort-indicator">▼</span></th>
                        <th data-sort="improvement" data-order="desc">Improvement <span class="sort-indicator desc">▼</span></th>
                        <th data-sort="improvementPercent">Improvement % <span class="sort-indicator">▼</span></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="chart-container">
            <h3>Talent Identification: Age vs. Improvement (Size = Minutes)</h3>
            <canvas id="talent-chart"></canvas>
        </div>
        <div class="training-calculator">
            <h3>Training Bonus Calculator</h3>
            <table id="training-table">
                <tbody></tbody>
            </table>
            <div class="training-actions">
                <div class="training-summary">
                    <p>Player fatigue must be between: <span id="training-range"></span></p>
                </div>
                <div>
                    <button class="edit-training-times-btn" id="edit-training-times-btn">Edit Times</button>
                    <button class="reset-training-btn" id="reset-training-btn">Reset Bonuses</button>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div id="power-ranking-content" class="content">
        <h2>Player Power Ranking</h2>
        <div class="minutes-form" style="margin-bottom: 20px;">
            <button class="confirm-minutes-btn" id="update-power-ranking-btn">UPDATE POWER RANKING</button>
            <p style="font-size: 12px; color: #666; margin-top: 8px; max-width: 600px; color:red">
                Before hitting the UPDATE button, do the following: <br>1. Enter all minutes played in the <a href="#" class="jump-to-tab" data-tab="minutes">MINUTES</a> tab.<br>2. Enter ALL GOALS and ASSISTS in the <a href="#" class="jump-to-tab" data-tab="goals-assists">GOALS & ASSISTS</a> tab.<br>3. Ensure player qualities are up to date in the <a href="#" class="jump-to-tab" data-tab="progress">PROGRESS</a> tab.<br>
            </p>
        </div>
        <div id="power-ranking-layout">
            <div class="table-container" id="power-ranking-table-container">
                <table id="power-ranking-table">
                    <thead>
                        <tr>
                            <th data-sort="rank">Rank</th>
                            <th data-sort="player">Player</th>
                            <th>Positions</th>
                            <th data-sort="change">+/-</th>
                            <th data-sort="powerScore" data-order="desc">Power Score ▼</th>
                            <th data-sort="currentQuality">Quality</th>
                            <th data-sort="improvementScore">Improvement</th>
                            <th data-sort="adjustedGaPer90">G+A Score</th>
                            <th data-sort="usageScore">Usage</th>
                            <th data-sort="ageValue">Age Bonus</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="power-ranking-chart-container" class="chart-container">
                 <h3>Power Ranking History</h3>
                 <div class="chart-zoom-controls">
                    <button class="chart-zoom-btn" id="zoom-in-btn">+</button>
                    <button class="chart-zoom-btn" id="zoom-out-btn">-</button>
                    <button class="chart-zoom-btn" id="reset-zoom-btn" style="font-size: 14px;">⟲</button>
                 </div>
                 <canvas id="power-ranking-chart"></canvas>
            </div>
        </div>
        <p style="text-align: center; font-size: 12px; color: #666; margin-top: 10px;">
            <br><b>Tip:</b> Hold <kbd>CTRL</kbd> and scroll to zoom, or use the +/- buttons. Click and drag to pan.
        </p>
        <div class="formula-explanation">
            <h3>How the Power Score is Calculated</h3>
            <div class="formula">
PowerScore = (QualityScore) + (ImprovementScore) + (G+A_Score) + (UsageScore) + (AgeBonus)
            </div>
            <h4>1. Quality Score</h4>
            <p>Calculates a player's value based on their current quality percentage using a cubic polynomial curve. This rewards higher-quality players exponentially, reflecting their on-pitch dominance.</p>
            <div class="formula">f(x) = 0.0001758x³ - 0.05093x² + 4.9956x - 156.47</div>
            <h4>2. Improvement Score</h4>
            <p>Assigns points based on the total quality improvement since the start of the season. This score is mapped to specific thresholds, rewarding significant progress.</p>
             <ul>
                <li><strong>+1-4% Increase:</strong> 0 points</li>
                <li><strong>+5-6% Increase:</strong> 1 point</li>
                <li><strong>+7-10% Increase:</strong> 2 points</li>
                 <li>...and so on, up to 20 points for a 30% increase.</li>
            </ul>
            <h4>3. G+A Score</h4>
            <p>Calculates a player's raw goal and assist output, weighted heavily by their position on the pitch to reward contributions from less offensive roles.</p>
            <ul>
                <li><strong>Forwards (ST, AML, AMC, AMR):</strong> <code>Goal = 1.1</code>, <code>Assist = 0.8</code></li>
                <li><strong>Midfielders (MC, ML, MR, DMC):</strong> <code>Goal = 1.8</code>, <code>Assist = 1.5</code></li>
                <li><strong>Defenders (DC, DL, DR, GK):</strong> <code>Goal = 2.7</code>, <code>Assist = 2.3</code></li>
            </ul>
            <h4>4. Usage Score</h4>
            <p>Measures a player's direct goal involvement per 90 minutes and scales it up. This emphasizes players who are efficient with their time on the pitch.</p>
            <div class="formula">UsageScore = (G+A per 90 minutes) × 3</div>
            <h4>5. Age Bonus</h4>
            <p>A small bonus awarded to younger players, reflecting their potential and future value.</p>
            <ul>
                <li><strong>18–21 years:</strong> +5 points</li>
                <li><strong>22–25 years:</strong> +3 points</li>
                <li><strong>26+ years:</strong> +2 points</li>
            </ul>
        </div>
    </div>
    
    <div id="archived-players-content" class="content">
        <h2>Archived Players</h2>
        <div class="minutes-form" id="archive-filters" style="margin-bottom: 20px;">
            <h3 style="margin: 0 0 10px 0; font-size: 16px;">Filter Archived Players</h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                <select id="archive-position-filter" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                    <option value="all">All Positions</option>
                    <option value="gk">Goalkeepers</option>
                    <option value="def">Defenders</option>
                    <option value="mid">Midfielders</option>
                    <option value="att">Strikers</option>
                </select>
                <input type="number" id="archive-age-filter-min" placeholder="Min Age" class="minutes-input">
                <input type="number" id="archive-age-filter-max" placeholder="Max Age" class="minutes-input">
                <input type="number" id="archive-minutes-filter-min" placeholder="Min Mins" class="minutes-input">
                <input type="number" id="archive-minutes-filter-max" placeholder="Max Mins" class="minutes-input">
                <input type="number" id="archive-matches-filter-min" placeholder="Min Matches" class="minutes-input">
                <input type="number" id="archive-matches-filter-max" placeholder="Max Matches" class="minutes-input">
                <input type="number" id="archive-goals-filter-min" placeholder="Min Goals" class="minutes-input">
                <input type="number" id="archive-goals-filter-max" placeholder="Max Goals" class="minutes-input">
                <input type="number" id="archive-assists-filter-min" placeholder="Min Assists" class="minutes-input">
                <input type="number" id="archive-assists-filter-max" placeholder="Max Assists" class="minutes-input">
                <button class="reset-minutes-btn" id="reset-archive-filters-btn">Reset Filters</button>
            </div>
        </div>
        <div class="table-container">
            <table id="archived-players-table">
                <thead>
                    <tr>
                        <th data-sort="name">Player <span class="sort-indicator">▼</span></th>
                        <th>Positions</th>
                        <th data-sort="age">Age <span class="sort-indicator">▼</span></th>
                        <th data-sort="minutes">Minutes <span class="sort-indicator">▼</span></th>
                        <th data-sort="matches">Matches <span class="sort-indicator">▼</span></th>
                        <th data-sort="avgMinPerMatch">Avg Min/Match <span class="sort-indicator">▼</span></th>
                        <th data-sort="goals">Goals <span class="sort-indicator">▼</span></th>
                        <th data-sort="assists">Assists <span class="sort-indicator">▼</span></th>
                        <th data-sort="gaPer90">G+A/90 <span class="sort-indicator">▼</span></th>
                        <th data-sort="archiveReason">Reason</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <div id="hall-of-fame-content" class="content">
        <div id="hall-of-fame-layout">
            <div id="hof-sidebar">
                <h3>Categories</h3>
                <button class="hof-category-btn active" data-category="matchesPlayed">Matches Played</button>
                <button class="hof-category-btn" data-category="totalMinutes">Total Minutes</button>
                <button class="hof-category-btn" data-category="goals">Total Goals</button>
                <button class="hof-category-btn" data-category="assists">Total Assists</button>
                <button class="hof-category-btn" data-category="gaPer90">G+A per 90</button>
            </div>
            <div id="hof-content">
                <h2 id="hof-title">Hall of Fame: Top 10 by Matches Played</h2>
                <div class="table-container" style="width: 80%;">
                    <table id="hof-table">
                        <thead>
                            <tr>
                                <th class="rank">Rank</th>
                                <th class="player-name">Player</th>
                                <th>Positions</th>
                                <th>Age</th>
                                <th>Seasons Played</th>
                                <th class="value" id="hof-value-header">Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Content will be generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div id="all-time-leaders-content" class="content">
        <div id="all-time-leaders-layout">
            <div id="atl-sidebar">
                <h3>Categories</h3>
                <button class="atl-category-btn active" data-category="matchesPlayed">Matches Played</button>
                <button class="atl-category-btn" data-category="totalMinutes">Total Minutes</button>
                <button class="atl-category-btn" data-category="goals">Total Goals</button>
                <button class="atl-category-btn" data-category="assists">Total Assists</button>
                <button class="atl-category-btn" data-category="gaPer90">G+A per 90</button>
            </div>
            <div id="atl-content">
                <h2 id="atl-title">All-Time Leaders: Top 10 by Matches Played</h2>
                <div class="table-container" style="width: 75%;">
                    <table id="atl-table">
                        <thead>
                            <tr>
                                <th class="rank">Rank</th>
                                <th class="player-name">Player</th>
                                <th>Positions</th>
                                <th>Age</th>
                                <th>Status</th>
                                <th class="value" id="atl-value-header">Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Content will be generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Player modal -->
    <div class="modal" id="player-modal">
        <div class="modal-content">
            <h2 id="modal-title">Add New Player</h2>
            <div class="form-group">
                <label for="player-name">Player Name:</label>
                <input type="text" id="player-name" required>
            </div>
            <div class="form-group">
                <label for="player-position">Position(s): <small>(Ctrl/Cmd + click for multiple, max 3)</small></label>
                <select id="player-position" multiple size="13" required>
                    <!--GK-->
                    <option value="GK">GK (Goalkeeper)</option>
                    <optgroup label="Defense">
                        <option value="DL">DL (Left Defender)</option>
                        <option value="DC">DC (Center Defender)</option>
                        <option value="DR">DR (Right Defender)</option>
                    </optgroup>
                    <optgroup label="Midfield">
                        <option value="DMC">DMC (Defensive Midfielder)</option>
                        <option value="ML">ML (Left Midfielder)</option>
                        <option value="MC">MC (Center Midfielder)</option>
                        <option value="MR">MR (Right Midfielder)</option>
                        <option value="AML">AML (Attacking Midfielder Left)</option>
                        <option value="AMC">AMC (Attacking Midfielder Center)</option>
                        <option value="AMR">AMR (Attacking Midfielder Right)</option>
                    </optgroup>
                    <optgroup label="Attack">
                        <option value="ST">ST (Striker)</option>
                    </optgroup>
                </select>
            </div>
            <div class="form-group">
                <label for="player-age">Age:</label>
                <input type="number" id="player-age" min="16" max="45" required>
            </div>
            <div class="form-group">
                <label for="player-quality">Quality (%):</label>
                <input type="number" id="player-quality" min="1" max="250" required>
            </div>
            <div class="modal-buttons">
                <button class="cancel-btn" id="cancel-btn">Cancel</button>
                <button class="save-btn" id="save-btn">Save</button>
            </div>
        </div>
    </div>
    
    <div class="confirm-modal" id="confirm-modal">
        <div class="confirm-content">
            <h3>Delete Player</h3>
            <p>Are you sure you want to delete this player?</p>
            <p id="player-to-delete"></p>
            <div class="confirm-buttons">
                <button class="cancel-btn" id="confirm-cancel">Cancel</button>
                <button class="save-btn" id="confirm-delete">Delete</button>
            </div>
        </div>
    </div>
    <!-- Archived Power Ranking Modal -->
    <div class="archived-pr-modal" id="archived-pr-modal">
        <div class="archived-pr-content">
            <button class="archived-pr-close" id="archived-pr-close">&times;</button>
            <h2 id="archived-pr-title">Season Power Rankings</h2>
            <div id="archived-pr-body">
                <!-- Content will be dynamically generated -->
            </div>
        </div>
    </div>
<script src="main.js"></script>
</body>
</html>
